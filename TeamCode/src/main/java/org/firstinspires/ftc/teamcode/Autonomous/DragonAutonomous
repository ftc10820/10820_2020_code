package org.firstinspires.ftc.teamcode;

import com.qualcomm.robotcore.eventloop.opmode.LinearOpMode;
import com.qualcomm.robotcore.hardware.ColorSensor;
import com.qualcomm.robotcore.hardware.Servo;
import com.qualcomm.robotcore.hardware.CRServo;
import com.qualcomm.robotcore.hardware.DcMotor;
import com.qualcomm.robotcore.eventloop.opmode.Autonomous;
import com.qualcomm.robotcore.eventloop.opmode.TeleOp;
import java.util.List;
import org.firstinspires.ftc.robotcore.external.hardware.camera.WebcamName;
import org.firstinspires.ftc.robotcore.external.navigation.VuforiaCurrentGame;
import org.firstinspires.ftc.robotcore.external.navigation.VuforiaLocalizer;
import org.firstinspires.ftc.robotcore.external.tfod.Recognition;
import org.firstinspires.ftc.robotcore.external.tfod.TfodCurrentGame;

@Autonomous
public class DragonAutonomous extends OpMode {
  
  // OpMode Members
  private ElapsedTime runtime = new ElapsedTime();
  
  // Detection Variables
  private VuforiaCurrentGame vuforiaUltimateGoal;
  private TfodCurrentGame tfodUltimateGoal;
  
  // motors
  private DcMotor drive1;
  private DcMotor drive2;
  private DcMotor drive3;
  private DcMotor drive4;
  private DcMotor shooter1;
  private DcMotor shooter2;
  private DcMotor intake;
  private DcMotor wafflemotor;
  private CRServo intakemotor;
  
  //servo
  private Servo waffle1;
  private Servo waffle2;

  // sensors
  private ColorSensor launchLine;



  Recognition recognition;
   
  // code to run ONCE when the driver hits INIT
  @Override
  public void init() {
    
    initializeRobot();
    
    List<Recognition> recognitions;
    double index;

    vuforiaUltimateGoal = new VuforiaCurrentGame();
    tfodUltimateGoal = new TfodCurrentGame();

    // Sample TFOD Op Mode
    // Initialize Vuforia.
    vuforiaUltimateGoal.initialize(
        "", // vuforiaLicenseKey
        hardwareMap.get(WebcamName.class, "Webcam 1"), // cameraName
        "", // webcamCalibrationFilename
        false, // useExtendedTracking
        false, // enableCameraMonitoring
        VuforiaLocalizer.Parameters.CameraMonitorFeedback.AXES, // cameraMonitorFeedback
        0, // dx
        0, // dy
        0, // dz
        0, // xAngle
        0, // yAngle
        0, // zAngle
        true); // useCompetitionFieldTargetLocations
    
      // Set min confidence threshold to 0.7
      tfodUltimateGoal.initialize(vuforiaUltimateGoal, 0.7F, true, true);
    
      // Initialize TFOD before waitForStart.
      // Init TFOD here so the object detection labels are visible
      // in the Camera Stream preview window on the Driver Station.
      tfodUltimateGoal.activate();

      // Enable following block to zoom in on target.
      tfodUltimateGoal.setZoom(2.5, 16 / 9);
      telemetry.addData(">", "Press Play to start");
      telemetry.update();
    
    }


    //Code to run REPEATEDLY after the driver hits INIT, but before they hit PLAY
    @Override init_loop() {
    
    }
    
    
    // Code to run ONCE when the driver hits PLAY
    @Override 
    public void start() {
      
      runtime.reset();
      
      while (launchLine.alpha() < 275) {
          
        drive1.setPower(0.5);
        drive2.setPower(0.5);
        drive3.setPower(0.5);
        drive4.setPower(0.5);
      
      }
      
      moveBackward(500);
      
      shooter(0.75);
      sleep(2000);
      
      inclinedPlane(1);
      sleep(2000);
      
      noodles(1);
      sleep(10000);
    
      stopEverything();
      
    }
    
   
    // Code to run REPEATEDLY once the driver hits PLAY but before they hit STOP
    @Override
    public void loop() {
    
        // Put loop blocks here.
        // Get a list of recognitions from TFOD.
        recognitions = tfodUltimateGoal.getRecognitions();
        
        // If list is empty, inform the user. Otherwise, go
        // through list and display info for each recognition.
        if (recognitions.size() == 0) {
        
          telemetry.addData("TFOD", "No items detected.");
          telemetry.addData("Target Zone", "A");
          
        } else {
        
          index = 0;
          
          // Iterate through list and call a function to
          // display info for each recognized object.
          for (Recognition recognition_item : recognitions) {
              
             recognition = recognition_item;
              
             // Display info.
             displayInfo(index);
              
             // Increment index.
             index = index + 1;
            
          }
          
        }
        
          sensorReadings(1000);
          telemetry.update();
   
    }
    
    
    @Override
    public void stop() {
    
    // Deactivate TFOD.
    tfodUltimateGoal.deactivate();

    vuforiaUltimateGoal.close();
    tfodUltimateGoal.close();
  
    } 
  
    // Display info (using telemetry) for a recognized object.
    private void displayInfo(double i) {
  
    // Display label info.
    // Display the label and index number for the recognition.
    telemetry.addData("label " + i, recognition.getLabel());
    
    // Display upper corner info.
    // Display the location of the top left corner
    // of the detection boundary for the recognition
    telemetry.addData("Left, Top " + i, recognition.getLeft() + ", " + recognition.getTop());
    
    // Display lower corner info.
    // Display the location of the bottom right corner
    // of the detection boundary for the recognition
    telemetry.addData("Right, Bottom " + i, recognition.getRight() + ", " + recognition.getBottom());
    
    // Target Zone Algorithm
    if (recognition.getLabel().equals("Single")) {
      
      telemetry.addData("Target Zone", "B");
      
    } else if (recognition.getLabel().equals("Quad")) {
      
      telemetry.addData("Target Zone", "C");
      
    } else {
      
      telemetry.addData("Target Zone", "A");
      
    }
  }
  
    
    private void initializeRobot() {
    
        //hardware maps of motors
        drive1 = hardwareMap.get(DcMotor.class, "drive1");
        drive2 = hardwareMap.get(DcMotor.class, "drive2");
        drive3 = hardwareMap.get(DcMotor.class, "drive3");
        drive4 = hardwareMap.get(DcMotor.class, "drive4");
        intake = hardwareMap.get(DcMotor.class, "intake");
        shooter1 = hardwareMap.get(DcMotor.class, "shooter1");
        shooter2 = hardwareMap.get(DcMotor.class, "shooter2");
        wafflemotor = hardwareMap.get(DcMotor.class, "wafflemotor");
        intakemotor = hardwareMap.get(CRServo.class, "intakemotor");
        launchLine = hardwareMap.get(ColorSensor.class, "color");

    
        //hardware maps of servos

        waffle1 = hardwareMap.get(Servo.class, "waffle1");
        waffle2 = hardwareMap.get(Servo.class, "waffle2");
    
        //directions
        drive1.setDirection(DcMotor.Direction.REVERSE);
        drive2.setDirection(DcMotor.Direction.REVERSE);
        drive3.setDirection(DcMotor.Direction.FORWARD);
        drive4.setDirection(DcMotor.Direction.FORWARD);
        intake.setDirection(DcMotor.Direction.FORWARD);
        shooter1.setDirection(DcMotor.Direction.REVERSE);
        shooter2.setDirection(DcMotor.Direction.REVERSE);
        wafflemotor.setDirection(DcMotor.Direction.FORWARD);
        intakemotor.setDirection(CRServo.Direction.FORWARD);
        
        //zero power behavior
        drive1.setZeroPowerBehavior(DcMotor.ZeroPowerBehavior.BRAKE);
        drive2.setZeroPowerBehavior(DcMotor.ZeroPowerBehavior.BRAKE);
        drive3.setZeroPowerBehavior(DcMotor.ZeroPowerBehavior.BRAKE);
        drive4.setZeroPowerBehavior(DcMotor.ZeroPowerBehavior.BRAKE);


        
        telemetry.addData("Status", "Initialized");
        telemetry.update();

    }
    
    
    private void moveForward(double power, long time) {
      
      drive1.setPower(power);
      drive2.setPower(power);
      drive3.setPower(power);
      drive4.setPower(power);
      sleep(time);
      
      drive1.setPower(0);
      drive2.setPower(0);
      drive3.setPower(0);
      drive4.setPower(0);
      
    }
    
    
    private void moveBackward(double power, long time) {
      
      drive1.setPower(power * -1.0);
      drive2.setPower(power * -1.0);
      drive3.setPower(power * -1.0);
      drive4.setPower(power * -1.0);
      sleep(time);
      
      drive1.setPower(0);
      drive2.setPower(0);
      drive3.setPower(0);
      drive4.setPower(0);
      
    }
    
    
    private void strafeRight(long time) {
    
      drive1.setPower(0.5);
      drive2.setPower(-0.5);
      drive3.setPower(-0.5);
      drive4.setPower(0.5);
      sleep(time);
      
      drive1.setPower(0);
      drive2.setPower(0);
      drive3.setPower(0);
      drive4.setPower(0);
      
    }
    
    
    private void strafeLeft(long time) {
    
      drive1.setPower(-0.5);
      drive2.setPower(0.5);
      drive3.setPower(0.5);
      drive4.setPower(-0.5);
      sleep(time);
      
      drive1.setPower(0);
      drive2.setPower(0);
      drive3.setPower(0);
      drive4.setPower(0);
      
    }
    
    
    private void shooter(double power) {
        
        shooter1.setPower(power);
        shooter2.setPower(power);
        
    }
    
    
    private void inclinedPlane(double power) {
        
        intake.setPower(power);
        
        
    }
    
    
    private void noodles(double power) {
        
        intakemotor.setPower(power);
        
    }
    
    
    private void waffleUp(long time) {
    
      wafflemotor.setPower(-0.5);
      sleep(time);
    
    }
    
    
    private void waffleDown(long time) {
    
      wafflemotor.setPower(0.5);
      sleep(time);
    
    }
    
    
    private void waffleOpen(long time) {
      
      waffle1.setPosition(-1);
      waffle2.setPosition(1);
      sleep(time);
    
    }
    
    
    private void waffleClose(long time) {
    
      waffle1.setPosition(1);
      waffle2.setPosition(-1);
      sleep(time);
      
    }
    
    
    private void stopRobot() {
      
      drive1.setPower(0);
      drive2.setPower(0);
      drive3.setPower(0);
      drive4.setPower(0);
    
    }
    
    
    private void stopEverything() {
    
      drive1.setPower(0);
      drive2.setPower(0);
      drive3.setPower(0);
      drive4.setPower(0);
      
      shooter1.setPower(0);
      shooter2.setPower(0);
      
      intake.setPower(0);
      
      intakemotor.setPower(0);
      
    }
    
    
    private void sensorReadings(long time) {
    
      // color sensor readings
      telemetry.addData("red:", launchLine.red());
      telemetry.addData("blue:", launchLine.blue());
      telemetry.addData("green:", launchLine.green());
      telemetry.addData("alpha:", launchLine.alpha());
      telemetry.update();
      sleep(time);
      
    }
    
    
    private void targetZoneA() {
        
        moveForward(1, 1000);
        
  
    }
    
    
    private void targetZoneB() {
        
        moveForward(1, 1000);
        
        
        
    }
    
    
    private void targetZoneC() {
        
        moveForward(1, 1000);
        
        
        
    }
    
    
    private void starterStackDetection() {
        
        if (recognition.getLabel().equals("Single")) {
      
            telemetry.addData("Target Zone", "B");
            
            
      
        } else if (recognition.getLabel().equals("Quad")) {
      
            telemetry.addData("Target Zone", "C");
      
        } else {
      
            telemetry.addData("Target Zone", "A");
      
            }
        
    }
    
    
}
